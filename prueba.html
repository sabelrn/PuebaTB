<html>
<head>
    <title>Conector Diligent VTA_ARAGORN</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js" type="text/javascript"></script>
    <script>
    (function () {
        var myConnector = tableau.makeConnector();

        myConnector.getSchema = function (schemaCallback) {
            var cols = [{ id: "id", dataType: tableau.dataTypeEnum.string }]; // Tableau necesita una columna inicial
            var tableSchema = { id: "VTA_ARAGORN", columns: cols };
            schemaCallback([tableSchema]);
        };

        myConnector.getData = function (table, doneCallback) {
            fetch("https://apis-us.diligentoneplatform.com/v1/orgs/24951/tables/1859274/records", {
                method: "GET",
                headers: { "Authorization": "Bearer 4cf68783ba50146116800b4b804e9298cfcd1bb5ff809a7c168adc311c975246" }
            })
            .then(response => response.json())
            .then(resp => {
                table.appendRows(resp.data.map(row => ({ "id": row.id })));
                doneCallback();
            });
        };

        tableau.registerConnector(myConnector);
        window.onload = function() { tableau.submit(); };
    })();
    </script>
</head>
<body>
    <p>Conectando con Diligent...</p>
</body>
</html>
